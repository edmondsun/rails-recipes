name: CICD

on:
  push:
    branches: [ master ]

jobs:
  pre_inspection:
    name: Publish and inspect Brakeman
    runs-on: ubuntu-18.04
    steps:
      - shell: bash
        run: |
          mkdir tmp/
          brakeman -o brakeman_file
      - name: Upload Brakeman report
        uses: actions/upload-artifact@v2
        with:
          name: brakeman_report
          path: brakeman_file

  download_report:
    name: Display results
    needs: pre_inspection
    runs-on: ubuntu-18.04
    steps:
      - name: Download Brakeman report
        uses: actions/download-artifact@v2
        with:
          name: brakeman_report
      - name: Print the final result
        shell: bash
        run: |
          value=`cat brakeman_report`
          echo The result is $value

    # steps:
    # - uses: actions/checkout@v2
    # - uses: actions/setup-ruby@v1
    #   with:
    #     ruby-version: 2.6.x
    # - name: Install gems
    #   run: |
    #     gem install brakeman
    # - name: brakeman report
    #   run: |
    #     mkdir tmp/
    #     brakeman -f json > tmp/brakeman.json || exit 0
    # - name: Archive production artifacts
    #   uses: actions/upload-artifact@v2
    #   with:
    #     name: 'archive-brakeman'
    #     path: |
    #       tmp/brakeman.json
    #     retention-days: 3
    # - name: Download Brakeman report
    #   uses: actions/download-artifact@v2
    #   with:
    #     name: 'archive-brakeman'
    # - name: Print the final result
    #   shell: bash
    #   run: |
    #     value=`cat tmp/brakeman.json`
    #     echo The result is $value

    # - uses: actions/download-artifact@v2
    #   id: download
    #   with:
    #     name: 'brakeman-artifact'
    #     path: 'tmp/brakeman-artifact-dist'
    # - name: brakeman report
    #   run: |
    #     mkdir tmp/
    #     brakeman -f json > tmp/${{steps.download.outputs.download-path}} || exit 0
    # - name: Brakeman
    #   uses: devmasx/brakeman-linter-action@v1.0.0
    #   env:
    #     GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
    #     REPORT_PATH: tmp/brakeman.json




